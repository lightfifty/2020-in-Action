# 协程

## 1.定义

广义定义：协程是一种在程序中**处理并发**的方案，它和线程是属于一个层级的概念。线程是支持并行的，但并行会导致很多问题，会有线程安全问题。协程中不存在线程，也不存在并行。

并发：Concurrency  

后台发请求，前台显示：并行

并行：Parallelism



Kotlin的协程本质上是基于JVM的，任何基于JVM的任何语言，都只能使用线程作为并发逻辑的底层实现。JVM运行只能使用线程来实现并发。

所以Kotlin的协程只能基于JVM的线程来实现。

先引入

```groovy
implementation "org.jetbrains.kotlinx:kotlinx-coroutines-core:1.1.1"
```

协程的方便之处来回切换特别方便，而线程的来回切换很麻烦。



两个后台线程共同协作 转到前台操作使用线程会很麻烦。





协程可以完全消除回调

要让协程运行在后台 选择在哪个线程开启协程

GlobalScope.launch(Dispatchers.Main){

// 协程块	

iocode()

uicode()

}

需要在后台工作的函数写上 suspend，该标记下面的方法里面会切换线程，在函数实现内部需要有具体切换线程的代码，标记执行在哪个线程。

private suspend fun ioCode(){// 定义挂起函数

withContext(Dispatchers.IO){

切换到io线程

}

}



使用协程可以提高软件性能，

工作耗时：放到后台

工作特殊：放到指定线程，一般来说是主线程更新UI。

耗时的代码需要放到后台，但是有可能不完全知道哪些代码是耗时的。



函数线程的切换是函数定义过程中决定的，不是调用者来切换的。

定义方法的人就可以确定方法内部的耗时任务一定在后台执行中。





需要学习下切换线程的方法

executor

thread



线程框架

可以用看起来同步的代码写出来实质上是异步的操作

耗时函数自动放到后台，从而提高性能。

线程的自动切回。



suspend的本质，解决函数执行完要切换回哪个线程。

挂起函数必须要在协程中使用，标记和提醒的作用。

编译过程中





















